<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.csplatform.course.mapper.UserCardSetMapper">

    <!-- 基础结果映射 -->
    <resultMap id="UserCardSetVOResultMap" type="com.csplatform.course.entity.vo.UserCardSetVO">
        <id property="id" column="id" jdbcType="BIGINT"/>
        <result property="userId" column="user_id" jdbcType="BIGINT"/>
        <result property="title" column="title" jdbcType="VARCHAR"/>
        <result property="coverUrl" column="cover_url" jdbcType="VARCHAR"/>
    </resultMap>

    <!-- 通过 user_card_set 表的 cardSetId 与 card_set 表的 id 关联查询 -->
    <!-- 查询用户关联的单词集列表（用户已拥有的单词集） -->
    <select id="selectLinkedCardSetsByUserId" resultMap="UserCardSetVOResultMap">
        SELECT
        ucs.id,               <!-- 这里改为 user_card_set 的 id -->
        cs.user_id,
        cs.title,
        cs.cover_url
        FROM card_set cs
        INNER JOIN user_card_set ucs ON cs.id = ucs.card_set_id
        WHERE ucs.user_id = #{userId}
        AND cs.status = 1
        AND ucs.status != 4
        ORDER BY cs.create_time DESC
    </select>
</mapper>